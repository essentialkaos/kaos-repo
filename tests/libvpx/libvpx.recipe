# Bibop recipe for libvpx
# See more: https://kaos.sh/bibop

pkg libvpx libvpx-devel libvpx-utils

fast-finish yes

var lib_linking_flags "-lvpx -lm"

command "-" "Check apps"
  app decode_to_md5
  app decode_with_drops
  app postproc
  app set_maps
  app simple_decoder
  app simple_encoder
  app tiny_ssim
  app twopass_encoder
  app vp8cx_set_ref
  app vp9_lossless_encoder
  app vp9_spatial_svc_encoder
  app vp9cx_set_ref
  app vpx_temporal_svc_encoder
  app vpxdec
  app vpxenc

command "-" "Check shared libs"
  lib-loaded libvpx.so.*

command "-" "Check headers"
  lib-header vpx

command "-" "Check pkg-config"
  lib-config vpx

command "-" "Check symbols exported by libvpx.so"
  lib-exported libvpx.so vpx_codec_build_config
  lib-exported libvpx.so vpx_codec_control_
  lib-exported libvpx.so vpx_codec_dec_init_ver
  lib-exported libvpx.so vpx_codec_decode
  lib-exported libvpx.so vpx_codec_destroy
  lib-exported libvpx.so vpx_codec_enc_config_default
  lib-exported libvpx.so vpx_codec_enc_config_set
  lib-exported libvpx.so vpx_codec_enc_init_multi_ver
  lib-exported libvpx.so vpx_codec_enc_init_ver
  lib-exported libvpx.so vpx_codec_encode
  lib-exported libvpx.so vpx_codec_error
  lib-exported libvpx.so vpx_codec_error_detail
  lib-exported libvpx.so vpx_codec_err_to_string
  lib-exported libvpx.so vpx_codec_get_caps
  lib-exported libvpx.so vpx_codec_get_cx_data
  lib-exported libvpx.so vpx_codec_get_frame
  lib-exported libvpx.so vpx_codec_get_global_headers
  lib-exported libvpx.so vpx_codec_get_preview_frame
  lib-exported libvpx.so vpx_codec_get_stream_info
  lib-exported libvpx.so vpx_codec_iface_name
  lib-exported libvpx.so vpx_codec_peek_stream_info
  lib-exported libvpx.so vpx_codec_register_put_frame_cb
  lib-exported libvpx.so vpx_codec_register_put_slice_cb
  lib-exported libvpx.so vpx_codec_set_cx_data_buf
  lib-exported libvpx.so vpx_codec_set_frame_buffer_functions
  lib-exported libvpx.so vpx_codec_version
  lib-exported libvpx.so vpx_codec_version_extra_str
  lib-exported libvpx.so vpx_codec_version_str
  lib-exported libvpx.so vpx_codec_vp8_cx
  lib-exported libvpx.so vpx_codec_vp8_cx_algo
  lib-exported libvpx.so vpx_codec_vp8_dx
  lib-exported libvpx.so vpx_codec_vp8_dx_algo
  lib-exported libvpx.so vpx_codec_vp9_cx
  lib-exported libvpx.so vpx_codec_vp9_cx_algo
  lib-exported libvpx.so vpx_codec_vp9_dx
  lib-exported libvpx.so vpx_codec_vp9_dx_algo
  lib-exported libvpx.so vpx_img_alloc
  lib-exported libvpx.so vpx_img_flip
  lib-exported libvpx.so vpx_img_free
  lib-exported libvpx.so vpx_img_set_rect
  lib-exported libvpx.so vpx_img_wrap

command "gcc -o test_bin {lib_linking_flags} test.c" "Compile binary"
  exit 0
  exist test_bin

+command "./test_bin" "Execute built binary"
  exit 0
