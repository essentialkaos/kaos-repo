# Bibop recipe for luajit
# See more: https://kaos.sh/bibop

pkg luajit libluajit libluajit-devel

fast-finish yes

var lib_version 5.1
var lib_linking_flags "-lluajit-{lib_version}"

command "-" "Check environment"
  app luajit-2.0.5

command "-" "Check shared libs"
  lib-loaded libluajit-{lib_version}.so.*

command "-" "Check static libs"
  exist /usr/lib64/libluajit-{lib_version}.a
  mode /usr/lib64/libluajit-{lib_version}.a 644

command "-" "Check headers"
  lib-header luajit-2.0

command "-" "Check pkg-config"
  lib-config luajit

command "-" "Check symbols exported by libluajit-{lib_version}.so"
  lib-exported libluajit-{lib_version}.so lua_atpanic
  lib-exported libluajit-{lib_version}.so lua_call
  lib-exported libluajit-{lib_version}.so lua_checkstack
  lib-exported libluajit-{lib_version}.so lua_close
  lib-exported libluajit-{lib_version}.so lua_concat
  lib-exported libluajit-{lib_version}.so lua_cpcall
  lib-exported libluajit-{lib_version}.so lua_createtable
  lib-exported libluajit-{lib_version}.so lua_dump
  lib-exported libluajit-{lib_version}.so lua_equal
  lib-exported libluajit-{lib_version}.so lua_error
  lib-exported libluajit-{lib_version}.so lua_gc
  lib-exported libluajit-{lib_version}.so lua_getallocf
  lib-exported libluajit-{lib_version}.so lua_getfenv
  lib-exported libluajit-{lib_version}.so lua_getfield
  lib-exported libluajit-{lib_version}.so lua_gethook
  lib-exported libluajit-{lib_version}.so lua_gethookcount
  lib-exported libluajit-{lib_version}.so lua_gethookmask
  lib-exported libluajit-{lib_version}.so lua_getinfo
  lib-exported libluajit-{lib_version}.so lua_getlocal
  lib-exported libluajit-{lib_version}.so lua_getmetatable
  lib-exported libluajit-{lib_version}.so lua_getstack
  lib-exported libluajit-{lib_version}.so lua_gettable
  lib-exported libluajit-{lib_version}.so lua_gettop
  lib-exported libluajit-{lib_version}.so lua_getupvalue
  lib-exported libluajit-{lib_version}.so lua_insert
  lib-exported libluajit-{lib_version}.so lua_iscfunction
  lib-exported libluajit-{lib_version}.so lua_isnumber
  lib-exported libluajit-{lib_version}.so lua_isstring
  lib-exported libluajit-{lib_version}.so lua_isuserdata
  lib-exported libluajit-{lib_version}.so luaJIT_setmode
  lib-exported libluajit-{lib_version}.so luaJIT_version_2_0_5
  lib-exported libluajit-{lib_version}.so luaL_addlstring
  lib-exported libluajit-{lib_version}.so luaL_addstring
  lib-exported libluajit-{lib_version}.so luaL_addvalue
  lib-exported libluajit-{lib_version}.so luaL_argerror
  lib-exported libluajit-{lib_version}.so luaL_buffinit
  lib-exported libluajit-{lib_version}.so luaL_callmeta
  lib-exported libluajit-{lib_version}.so luaL_checkany
  lib-exported libluajit-{lib_version}.so luaL_checkinteger
  lib-exported libluajit-{lib_version}.so luaL_checklstring
  lib-exported libluajit-{lib_version}.so luaL_checknumber
  lib-exported libluajit-{lib_version}.so luaL_checkoption
  lib-exported libluajit-{lib_version}.so luaL_checkstack
  lib-exported libluajit-{lib_version}.so luaL_checktype
  lib-exported libluajit-{lib_version}.so luaL_checkudata
  lib-exported libluajit-{lib_version}.so luaL_error
  lib-exported libluajit-{lib_version}.so lua_lessthan
  lib-exported libluajit-{lib_version}.so luaL_execresult
  lib-exported libluajit-{lib_version}.so luaL_fileresult
  lib-exported libluajit-{lib_version}.so luaL_findtable
  lib-exported libluajit-{lib_version}.so luaL_getmetafield
  lib-exported libluajit-{lib_version}.so luaL_gsub
  lib-exported libluajit-{lib_version}.so luaL_loadbuffer
  lib-exported libluajit-{lib_version}.so luaL_loadbufferx
  lib-exported libluajit-{lib_version}.so luaL_loadfile
  lib-exported libluajit-{lib_version}.so luaL_loadfilex
  lib-exported libluajit-{lib_version}.so luaL_loadstring
  lib-exported libluajit-{lib_version}.so luaL_newmetatable
  lib-exported libluajit-{lib_version}.so luaL_newstate
  lib-exported libluajit-{lib_version}.so lua_load
  lib-exported libluajit-{lib_version}.so lua_loadx
  lib-exported libluajit-{lib_version}.so luaL_openlib
  lib-exported libluajit-{lib_version}.so luaL_openlibs
  lib-exported libluajit-{lib_version}.so luaL_optinteger
  lib-exported libluajit-{lib_version}.so luaL_optlstring
  lib-exported libluajit-{lib_version}.so luaL_optnumber
  lib-exported libluajit-{lib_version}.so luaL_prepbuffer
  lib-exported libluajit-{lib_version}.so luaL_pushresult
  lib-exported libluajit-{lib_version}.so luaL_ref
  lib-exported libluajit-{lib_version}.so luaL_register
  lib-exported libluajit-{lib_version}.so luaL_traceback
  lib-exported libluajit-{lib_version}.so luaL_typerror
  lib-exported libluajit-{lib_version}.so luaL_unref
  lib-exported libluajit-{lib_version}.so luaL_where
  lib-exported libluajit-{lib_version}.so lua_newstate
  lib-exported libluajit-{lib_version}.so lua_newthread
  lib-exported libluajit-{lib_version}.so lua_newuserdata
  lib-exported libluajit-{lib_version}.so lua_next
  lib-exported libluajit-{lib_version}.so lua_objlen
  lib-exported libluajit-{lib_version}.so luaopen_base
  lib-exported libluajit-{lib_version}.so luaopen_bit
  lib-exported libluajit-{lib_version}.so luaopen_debug
  lib-exported libluajit-{lib_version}.so luaopen_ffi
  lib-exported libluajit-{lib_version}.so luaopen_io
  lib-exported libluajit-{lib_version}.so luaopen_jit
  lib-exported libluajit-{lib_version}.so luaopen_math
  lib-exported libluajit-{lib_version}.so luaopen_os
  lib-exported libluajit-{lib_version}.so luaopen_package
  lib-exported libluajit-{lib_version}.so luaopen_string
  lib-exported libluajit-{lib_version}.so luaopen_table
  lib-exported libluajit-{lib_version}.so lua_pcall
  lib-exported libluajit-{lib_version}.so lua_pushboolean
  lib-exported libluajit-{lib_version}.so lua_pushcclosure
  lib-exported libluajit-{lib_version}.so lua_pushfstring
  lib-exported libluajit-{lib_version}.so lua_pushinteger
  lib-exported libluajit-{lib_version}.so lua_pushlightuserdata
  lib-exported libluajit-{lib_version}.so lua_pushlstring
  lib-exported libluajit-{lib_version}.so lua_pushnil
  lib-exported libluajit-{lib_version}.so lua_pushnumber
  lib-exported libluajit-{lib_version}.so lua_pushstring
  lib-exported libluajit-{lib_version}.so lua_pushthread
  lib-exported libluajit-{lib_version}.so lua_pushvalue
  lib-exported libluajit-{lib_version}.so lua_pushvfstring
  lib-exported libluajit-{lib_version}.so lua_rawequal
  lib-exported libluajit-{lib_version}.so lua_rawget
  lib-exported libluajit-{lib_version}.so lua_rawgeti
  lib-exported libluajit-{lib_version}.so lua_rawset
  lib-exported libluajit-{lib_version}.so lua_rawseti
  lib-exported libluajit-{lib_version}.so lua_remove
  lib-exported libluajit-{lib_version}.so lua_replace
  lib-exported libluajit-{lib_version}.so lua_resume
  lib-exported libluajit-{lib_version}.so lua_setallocf
  lib-exported libluajit-{lib_version}.so lua_setfenv
  lib-exported libluajit-{lib_version}.so lua_setfield
  lib-exported libluajit-{lib_version}.so lua_sethook
  lib-exported libluajit-{lib_version}.so lua_setlocal
  lib-exported libluajit-{lib_version}.so lua_setmetatable
  lib-exported libluajit-{lib_version}.so lua_settable
  lib-exported libluajit-{lib_version}.so lua_settop
  lib-exported libluajit-{lib_version}.so lua_setupvalue
  lib-exported libluajit-{lib_version}.so lua_status
  lib-exported libluajit-{lib_version}.so lua_toboolean
  lib-exported libluajit-{lib_version}.so lua_tocfunction
  lib-exported libluajit-{lib_version}.so lua_tointeger
  lib-exported libluajit-{lib_version}.so lua_tolstring
  lib-exported libluajit-{lib_version}.so lua_tonumber
  lib-exported libluajit-{lib_version}.so lua_topointer
  lib-exported libluajit-{lib_version}.so lua_tothread
  lib-exported libluajit-{lib_version}.so lua_touserdata
  lib-exported libluajit-{lib_version}.so lua_type
  lib-exported libluajit-{lib_version}.so lua_typename
  lib-exported libluajit-{lib_version}.so lua_upvalueid
  lib-exported libluajit-{lib_version}.so lua_upvaluejoin
  lib-exported libluajit-{lib_version}.so lua_xmove
  lib-exported libluajit-{lib_version}.so lua_yield

command "gcc -o test_bin {lib_linking_flags} test.c" "Compile binary"
  exit 0
  exist test_bin

+command "./test_bin" "Execute built binary"
  exit 0
