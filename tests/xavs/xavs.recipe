# Bibop recipe for xavs
# See more: https://kaos.sh/bibop

pkg xavs xavs-devel

fast-finish yes

var lib_linking_flags "-lxavs"

command "-" "Check environment"
  app xavs

command "-" "Check shared libs"
  lib-loaded libxavs.so.*

command "-" "Check static libs"
  exist /usr/lib64/libxavs.a
  mode /usr/lib64/libxavs.a 644

command "-" "Check headers"
  lib-header xavs.h

command "-" "Check pkg-config"
  lib-config xavs

command "-" "Check symbols exported by libxavs.so"
  lib-exported libxavs.so dequant_8x8
  lib-exported libxavs.so quant_8x8
  lib-exported libxavs.so scan_zigzag_8x8full
  lib-exported libxavs.so sub_zigzag_8x8full
  lib-exported libxavs.so xavs_cpu_detect
  lib-exported libxavs.so xavs_cpu_names
  lib-exported libxavs.so xavs_cpu_num_processors
  lib-exported libxavs.so xavs_cpu_restore
  lib-exported libxavs.so xavs_cqm_delete
  lib-exported libxavs.so xavs_cqm_init
  lib-exported libxavs.so xavs_cqm_parse_file
  lib-exported libxavs.so xavs_cqm_parse_jmlist
  lib-exported libxavs.so xavs_csp_init
  lib-exported libxavs.so xavs_dct_init
  lib-exported libxavs.so xavs_deblock_init
  lib-exported libxavs.so xavs_denoise_dct
  lib-exported libxavs.so xavs_emms
  lib-exported libxavs.so xavs_encoder_close
  lib-exported libxavs.so xavs_encoder_delayed_frames
  lib-exported libxavs.so xavs_encoder_encode
  lib-exported libxavs.so xavs_encoder_headers
  lib-exported libxavs.so xavs_encoder_open
  lib-exported libxavs.so xavs_encoder_reconfig
  lib-exported libxavs.so xavs_eval
  lib-exported libxavs.so xavs_frame_copy_picture
  lib-exported libxavs.so xavs_frame_deblocking_filter
  lib-exported libxavs.so xavs_frame_delete
  lib-exported libxavs.so xavs_frame_expand_border
  lib-exported libxavs.so xavs_frame_expand_border_filtered
  lib-exported libxavs.so xavs_frame_expand_border_lowres
  lib-exported libxavs.so xavs_frame_expand_border_mod16
  lib-exported libxavs.so xavs_frame_filter
  lib-exported libxavs.so xavs_frame_get
  lib-exported libxavs.so xavs_frame_get_unused
  lib-exported libxavs.so xavs_frame_init_lowres
  lib-exported libxavs.so xavs_frame_new
  lib-exported libxavs.so xavs_frame_push
  lib-exported libxavs.so xavs_frame_put
  lib-exported libxavs.so xavs_frame_put_unused
  lib-exported libxavs.so xavs_free
  lib-exported libxavs.so xavs_i_picture_write
  lib-exported libxavs.so xavs_levels
  lib-exported libxavs.so xavs_log
  lib-exported libxavs.so xavs_lookahead_delete
  lib-exported libxavs.so xavs_lookahead_get_frames
  lib-exported libxavs.so xavs_lookahead_init
  lib-exported libxavs.so xavs_lookahead_is_empty
  lib-exported libxavs.so xavs_lookahead_put_frame
  lib-exported libxavs.so xavs_macroblock_analyse
  lib-exported libxavs.so xavs_macroblock_bipred_init
  lib-exported libxavs.so xavs_macroblock_cache_end
  lib-exported libxavs.so xavs_macroblock_cache_init
  lib-exported libxavs.so xavs_macroblock_cache_load
  lib-exported libxavs.so xavs_macroblock_cache_save
  lib-exported libxavs.so xavs_macroblock_encode
  lib-exported libxavs.so xavs_macroblock_encode_p8x8
  lib-exported libxavs.so xavs_macroblock_encode_pskip
  lib-exported libxavs.so xavs_macroblock_probe_skip
  lib-exported libxavs.so xavs_macroblock_size_cavlc
  lib-exported libxavs.so xavs_macroblock_slice_init
  lib-exported libxavs.so xavs_macroblock_write_cavlc
  lib-exported libxavs.so xavs_malloc
  lib-exported libxavs.so xavs_mb_encode_8x8_chroma
  lib-exported libxavs.so xavs_mb_encode_i8x8
  lib-exported libxavs.so xavs_mb_load_mv_direct8x8
  lib-exported libxavs.so xavs_mb_mc
  lib-exported libxavs.so xavs_mb_mc_8x8
  lib-exported libxavs.so xavs_mb_predict_intra4x4_mode
  lib-exported libxavs.so xavs_mb_predict_mv
  lib-exported libxavs.so xavs_mb_predict_mv_16x16
  lib-exported libxavs.so xavs_mb_predict_mv_direct16x16
  lib-exported libxavs.so xavs_mb_predict_mv_pskip
  lib-exported libxavs.so xavs_mb_predict_mv_ref16x16
  lib-exported libxavs.so xavs_mb_predict_non_zero_code
  lib-exported libxavs.so xavs_mb_transform_8x8_allowed
  lib-exported libxavs.so xavs_mc_init
  lib-exported libxavs.so xavs_mdate
  lib-exported libxavs.so xavs_me_refine_bidir
  lib-exported libxavs.so xavs_me_refine_qpel
  lib-exported libxavs.so xavs_me_refine_qpel_rd
  lib-exported libxavs.so xavs_me_search_ref
  lib-exported libxavs.so xavs_nal_decode
  lib-exported libxavs.so xavs_nal_encode
  lib-exported libxavs.so xavs_noise_reduction_update
  lib-exported libxavs.so xavs_param2string
  lib-exported libxavs.so xavs_param_default
  lib-exported libxavs.so xavs_partition_size_cavlc
  lib-exported libxavs.so xavs_pb_picture_write
  lib-exported libxavs.so xavs_picture_alloc
  lib-exported libxavs.so xavs_picture_clean
  lib-exported libxavs.so xavs_pixel_init
  lib-exported libxavs.so xavs_pixel_ssd_wxh
  lib-exported libxavs.so xavs_pps_init
  lib-exported libxavs.so xavs_pps_write
  lib-exported libxavs.so xavs_predict_8x8c_init
  lib-exported libxavs.so xavs_predict_8x8_init
  lib-exported libxavs.so xavs_quant_8x8_trellis
  lib-exported libxavs.so xavs_quant_init
  lib-exported libxavs.so xavs_ratecontrol_delete
  lib-exported libxavs.so xavs_ratecontrol_end
  lib-exported libxavs.so xavs_ratecontrol_get_estimated_size
  lib-exported libxavs.so xavs_ratecontrol_mb
  lib-exported libxavs.so xavs_ratecontrol_new
  lib-exported libxavs.so xavs_ratecontrol_qp
  lib-exported libxavs.so xavs_ratecontrol_set_estimated_size
  lib-exported libxavs.so xavs_ratecontrol_slice_type
  lib-exported libxavs.so xavs_ratecontrol_start
  lib-exported libxavs.so xavs_ratecontrol_summary
  lib-exported libxavs.so xavs_rc_analyse_slice
  lib-exported libxavs.so xavs_rd_cost_i8x8
  lib-exported libxavs.so xavs_rd_cost_part
  lib-exported libxavs.so xavs_realloc
  lib-exported libxavs.so xavs_reduce_fraction
  lib-exported libxavs.so xavs_sei_version_write
  lib-exported libxavs.so xavs_sequence_end_write
  lib-exported libxavs.so xavs_sequence_init
  lib-exported libxavs.so xavs_sequence_write
  lib-exported libxavs.so xavs_slicetype_analyse
  lib-exported libxavs.so xavs_slicetype_decide
  lib-exported libxavs.so xavs_slicetype_frame_cost
  lib-exported libxavs.so xavs_slicetype_mb_cost
  lib-exported libxavs.so xavs_slurp_file
  lib-exported libxavs.so xavs_sps_init
  lib-exported libxavs.so xavs_sps_write
  lib-exported libxavs.so xavs_synch_frame_list_delete
  lib-exported libxavs.so xavs_synch_frame_list_init
  lib-exported libxavs.so xavs_synch_frame_list_push
  lib-exported libxavs.so xavs_thread_sync_ratecontrol
  lib-exported libxavs.so xavs_validate_levels
  lib-exported libxavs.so xavs_zigzag_init

command "gcc -o test_bin {lib_linking_flags} test.c" "Compile binary"
  exit 0
  exist test_bin

+command "./test_bin" "Execute built binary"
  exit 0
