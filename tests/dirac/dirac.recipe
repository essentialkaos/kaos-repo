# Bibop recipe for dirac
# See more: https://kaos.sh/bibop

pkg gcc dirac dirac-devel dirac-docs dirac-libs

fast-finish yes

var lib_name dirac

command "-" "Check apps"
  app create_{lib_name}_testfile.pl
  app {lib_name}_BMPtoRGB
  app {lib_name}_RGBtoBMP
  app {lib_name}_RGBtoUYVY
  app {lib_name}_RGBtoYUV411
  app {lib_name}_RGBtoYUV420
  app {lib_name}_RGBtoYUV422
  app {lib_name}_RGBtoYUV444
  app {lib_name}_UYVYtoRGB
  app {lib_name}_UYVYtoYUV422
  app {lib_name}_YUV411toRGB
  app {lib_name}_YUV420Down2x2
  app {lib_name}_YUV420ItoYUV422I
  app {lib_name}_YUV420pt75filter
  app {lib_name}_YUV420toRGB
  app {lib_name}_YUV420toYUV422
  app {lib_name}_YUV422ItoYUV420I
  app {lib_name}_YUV422toRGB
  app {lib_name}_YUV422toUYVY
  app {lib_name}_YUV422toYUV420
  app {lib_name}_YUV444toRGB
  app {lib_name}_decoder
  app {lib_name}_encoder
  app {lib_name}_instrumentation
  app {lib_name}_unittest

command "-" "Check shared libs"
  lib-loaded lib{lib_name}_decoder.so.*
  lib-loaded lib{lib_name}_encoder.so.*

command "-" "Check headers"
  lib-header {lib_name}

command "-" "Check pkg-config"
  lib-config {lib_name}

command "-" "Check symbols exported by lib{lib_name}_encoder.so"
  lib-exported lib{lib_name}_encoder.so {lib_name}_encoder_close
  lib-exported lib{lib_name}_encoder.so {lib_name}_encoder_context_init
  lib-exported lib{lib_name}_encoder.so {lib_name}_encoder_end_sequence
  lib-exported lib{lib_name}_encoder.so {lib_name}_encoder_init
  lib-exported lib{lib_name}_encoder.so {lib_name}_encoder_load
  lib-exported lib{lib_name}_encoder.so {lib_name}_encoder_output
  lib-exported lib{lib_name}_encoder.so {lib_name}_encoder_pts_offset

command "-" "Check symbols exported by lib{lib_name}_decoder.so"
  lib-exported lib{lib_name}_decoder.so {lib_name}_buffer
  lib-exported lib{lib_name}_decoder.so {lib_name}_decoder_close
  lib-exported lib{lib_name}_decoder.so {lib_name}_decoder_init
  lib-exported lib{lib_name}_decoder.so {lib_name}_parse
  lib-exported lib{lib_name}_decoder.so {lib_name}_set_buf

command "./test_{ARCH_BITS}" "Check prebuilt binary"
  exit 0

command "gcc -o test_bin -l {lib_name}_encoder -l {lib_name}_decoder -I /usr/include/{lib_name} test.c" "Compile binary"
  exit 0
  exist test_bin

+command "./test_bin" "Execute built binary"
  exit 0
