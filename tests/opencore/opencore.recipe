# Bibop recipe for opencore
# See more: https://kaos.sh/bibop

pkg opencore-amr opencore-amr-devel

fast-finish yes

var amrnb_linking_flags "-lopencore-amrnb"
var amrwb_linking_flags "-lopencore-amrwb"

command "-" "Check shared libs"
  lib-loaded libopencore-amrnb.so.*
  lib-loaded libopencore-amrwb.so.*

command "-" "Check headers"
  lib-header opencore-amrnb
  lib-header opencore-amrwb

command "-" "Check pkg-config"
  lib-config opencore-amrnb
  lib-config opencore-amrwb

command "-" "Check symbols exported by libopencore-amrnb.so"
  lib-exported libopencore-amrnb.so Decoder_Interface_Decode
  lib-exported libopencore-amrnb.so Decoder_Interface_exit
  lib-exported libopencore-amrnb.so Decoder_Interface_init
  lib-exported libopencore-amrnb.so Encoder_Interface_Encode
  lib-exported libopencore-amrnb.so Encoder_Interface_exit
  lib-exported libopencore-amrnb.so Encoder_Interface_init

command "-" "Check symbols exported by libopencore-amrwb.so"
  lib-exported libopencore-amrwb.so D_IF_decode
  lib-exported libopencore-amrwb.so D_IF_exit
  lib-exported libopencore-amrwb.so D_IF_init

command "gcc -o test_amrnb_bin {amrnb_linking_flags} test-amrnb.c" "Compile binary"
  exit 0
  exist test_amrnb_bin

+command "./test_amrnb_bin" "Execute built binary"
  exit 0

command "gcc -o test_amrwb_bin {amrwb_linking_flags} test-amrwb.c" "Compile binary"
  exit 0
  exist test_amrwb_bin

+command "./test_amrwb_bin" "Execute built binary"
  exit 0
