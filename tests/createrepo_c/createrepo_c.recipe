# Bibop recipe for createrepo_c
# See more: https://kaos.sh/bibop

pkg createrepo_c createrepo_c-devel createrepo_c-libs

fast-finish yes

command "-" "Check environment"
  app createrepo_c

command "-" "Check libs"
  lib-loaded libcreaterepo_c.so.*
  lib-config createrepo_c
  lib-header createrepo_c

command "createrepo_c -p -d --workers=1 --simple-md-filenames ." "Generate test metadata"
  exit 0
  dir repodata

+command "-" "Check generated metadata"
  exist "repodata/filelists.sqlite.bz2"
  exist "repodata/filelists.xml.gz"
  exist "repodata/other.sqlite.bz2"
  exist "repodata/other.xml.gz"
  exist "repodata/primary.sqlite.bz2"
  exist "repodata/primary.xml.gz"
  exist "repodata/repomd.xml"

  mode "repodata/filelists.sqlite.bz2" 644
  mode "repodata/filelists.xml.gz" 644
  mode "repodata/other.sqlite.bz2" 644
  mode "repodata/other.xml.gz" 644
  mode "repodata/primary.sqlite.bz2" 644
  mode "repodata/primary.xml.gz" 644
  mode "repodata/repomd.xml" 644

  !empty "repodata/filelists.sqlite.bz2"
  !empty "repodata/filelists.xml.gz"
  !empty "repodata/other.sqlite.bz2"
  !empty "repodata/other.xml.gz"
  !empty "repodata/primary.sqlite.bz2"
  !empty "repodata/primary.xml.gz"
  !empty "repodata/repomd.xml"
