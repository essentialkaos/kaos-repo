# Bibop recipe for Opus
# See more: https://kaos.sh/bibop

pkg opus opus-devel

fast-finish yes

var lib_linking_flags "-lopus"

command "-" "Check shared libs"
  lib-loaded libopus.so.*

command "-" "Check headers"
  lib-header opus

command "-" "Check pkg-config"
  lib-config opus

command "-" "Check symbols exported by libopus.so"
  lib-exported libopus.so opus_custom_decode
  lib-exported libopus.so opus_custom_decode_float
  lib-exported libopus.so opus_custom_decoder_create
  lib-exported libopus.so opus_custom_decoder_ctl
  lib-exported libopus.so opus_custom_decoder_destroy
  lib-exported libopus.so opus_custom_decoder_get_size
  lib-exported libopus.so opus_custom_decoder_init
  lib-exported libopus.so opus_custom_encode
  lib-exported libopus.so opus_custom_encode_float
  lib-exported libopus.so opus_custom_encoder_create
  lib-exported libopus.so opus_custom_encoder_ctl
  lib-exported libopus.so opus_custom_encoder_destroy
  lib-exported libopus.so opus_custom_encoder_get_size
  lib-exported libopus.so opus_custom_encoder_init
  lib-exported libopus.so opus_custom_mode_create
  lib-exported libopus.so opus_custom_mode_destroy
  lib-exported libopus.so opus_decode
  lib-exported libopus.so opus_decode_float
  lib-exported libopus.so opus_decoder_create
  lib-exported libopus.so opus_decoder_ctl
  lib-exported libopus.so opus_decoder_destroy
  lib-exported libopus.so opus_decoder_get_nb_samples
  lib-exported libopus.so opus_decoder_get_size
  lib-exported libopus.so opus_decoder_init
  lib-exported libopus.so opus_encode
  lib-exported libopus.so opus_encode_float
  lib-exported libopus.so opus_encoder_create
  lib-exported libopus.so opus_encoder_ctl
  lib-exported libopus.so opus_encoder_destroy
  lib-exported libopus.so opus_encoder_get_size
  lib-exported libopus.so opus_encoder_init
  lib-exported libopus.so opus_get_version_string
  lib-exported libopus.so opus_multistream_decode
  lib-exported libopus.so opus_multistream_decode_float
  lib-exported libopus.so opus_multistream_decoder_create
  lib-exported libopus.so opus_multistream_decoder_ctl
  lib-exported libopus.so opus_multistream_decoder_destroy
  lib-exported libopus.so opus_multistream_decoder_get_size
  lib-exported libopus.so opus_multistream_decoder_init
  lib-exported libopus.so opus_multistream_encode
  lib-exported libopus.so opus_multistream_encode_float
  lib-exported libopus.so opus_multistream_encoder_create
  lib-exported libopus.so opus_multistream_encoder_ctl
  lib-exported libopus.so opus_multistream_encoder_destroy
  lib-exported libopus.so opus_multistream_encoder_get_size
  lib-exported libopus.so opus_multistream_encoder_init
  lib-exported libopus.so opus_multistream_packet_pad
  lib-exported libopus.so opus_multistream_packet_unpad
  lib-exported libopus.so opus_multistream_surround_encoder_create
  lib-exported libopus.so opus_multistream_surround_encoder_get_size
  lib-exported libopus.so opus_multistream_surround_encoder_init
  lib-exported libopus.so opus_packet_get_bandwidth
  lib-exported libopus.so opus_packet_get_nb_channels
  lib-exported libopus.so opus_packet_get_nb_frames
  lib-exported libopus.so opus_packet_get_nb_samples
  lib-exported libopus.so opus_packet_get_samples_per_frame
  lib-exported libopus.so opus_packet_pad
  lib-exported libopus.so opus_packet_parse
  lib-exported libopus.so opus_packet_unpad
  lib-exported libopus.so opus_pcm_soft_clip
  lib-exported libopus.so opus_projection_ambisonics_encoder_create
  lib-exported libopus.so opus_projection_ambisonics_encoder_get_size
  lib-exported libopus.so opus_projection_ambisonics_encoder_init
  lib-exported libopus.so opus_projection_decode
  lib-exported libopus.so opus_projection_decode_float
  lib-exported libopus.so opus_projection_decoder_create
  lib-exported libopus.so opus_projection_decoder_ctl
  lib-exported libopus.so opus_projection_decoder_destroy
  lib-exported libopus.so opus_projection_decoder_get_size
  lib-exported libopus.so opus_projection_decoder_init
  lib-exported libopus.so opus_projection_encode
  lib-exported libopus.so opus_projection_encode_float
  lib-exported libopus.so opus_projection_encoder_ctl
  lib-exported libopus.so opus_projection_encoder_destroy
  lib-exported libopus.so opus_repacketizer_cat
  lib-exported libopus.so opus_repacketizer_create
  lib-exported libopus.so opus_repacketizer_destroy
  lib-exported libopus.so opus_repacketizer_get_nb_frames
  lib-exported libopus.so opus_repacketizer_get_size
  lib-exported libopus.so opus_repacketizer_init
  lib-exported libopus.so opus_repacketizer_out
  lib-exported libopus.so opus_repacketizer_out_range
  lib-exported libopus.so opus_strerror

command "gcc -o test_bin {lib_linking_flags} test.c" "Compile binary"
  exit 0
  exist test_bin

+command "./test_bin" "Execute built binary"
  exit 0
