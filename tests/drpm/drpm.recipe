# Bibop recipe for drpm
# See more: https://kaos.sh/bibop

pkg drpm drpm-devel

fast-finish yes

var lib_linking_flags "-ldrpm"

command "-" "Check shared libs"
  lib-loaded libdrpm.so.*

command "-" "Check headers"
  lib-header drpm.h

command "-" "Check pkg-config"
  lib-config drpm

command "-" "Check symbols exported by libdrpm.so"
  lib-exported libdrpm.so block_id
  lib-exported libdrpm.so blocks_create
  lib-exported libdrpm.so blocks_destroy
  lib-exported libdrpm.so block_size
  lib-exported libdrpm.so blocks_next
  lib-exported libdrpm.so compstrm_destroy
  lib-exported libdrpm.so compstrm_finish
  lib-exported libdrpm.so compstrm_init
  lib-exported libdrpm.so compstrm_wrapper_destroy
  lib-exported libdrpm.so compstrm_wrapper_finish
  lib-exported libdrpm.so compstrm_wrapper_init
  lib-exported libdrpm.so compstrm_wrapper_write
  lib-exported libdrpm.so compstrm_write
  lib-exported libdrpm.so compstrm_write_be32
  lib-exported libdrpm.so compstrm_write_be64
  lib-exported libdrpm.so cpio_header_read
  lib-exported libdrpm.so cpio_header_write
  lib-exported libdrpm.so create_be32
  lib-exported libdrpm.so create_be64
  lib-exported libdrpm.so decompstrm_destroy
  lib-exported libdrpm.so decompstrm_get_comp_size
  lib-exported libdrpm.so decompstrm_init
  lib-exported libdrpm.so decompstrm_read
  lib-exported libdrpm.so decompstrm_read_be32
  lib-exported libdrpm.so decompstrm_read_be64
  lib-exported libdrpm.so decompstrm_read_until_eof
  lib-exported libdrpm.so deltarpm_decode_comp
  lib-exported libdrpm.so deltarpm_encode_comp
  lib-exported libdrpm.so deltarpm_to_drpm
  lib-exported libdrpm.so drpm_apply
  lib-exported libdrpm.so drpm_check
  lib-exported libdrpm.so drpm_check_sequence
  lib-exported libdrpm.so drpm_destroy
  lib-exported libdrpm.so drpm_free
  lib-exported libdrpm.so drpm_get_string
  lib-exported libdrpm.so drpm_get_uint
  lib-exported libdrpm.so drpm_get_ullong
  lib-exported libdrpm.so drpm_get_ulong
  lib-exported libdrpm.so drpm_get_ulong_array
  lib-exported libdrpm.so drpm_make
  lib-exported libdrpm.so drpm_make_options_add_patches
  lib-exported libdrpm.so drpm_make_options_copy
  lib-exported libdrpm.so drpm_make_options_defaults
  lib-exported libdrpm.so drpm_make_options_destroy
  lib-exported libdrpm.so drpm_make_options_forbid_addblk
  lib-exported libdrpm.so drpm_make_options_get_delta_comp_from_rpm
  lib-exported libdrpm.so drpm_make_options_init
  lib-exported libdrpm.so drpm_make_options_set_addblk_comp
  lib-exported libdrpm.so drpm_make_options_set_delta_comp
  lib-exported libdrpm.so drpm_make_options_set_memlimit
  lib-exported libdrpm.so drpm_make_options_set_seqfile
  lib-exported libdrpm.so drpm_make_options_set_type
  lib-exported libdrpm.so drpm_make_options_set_version
  lib-exported libdrpm.so drpm_read
  lib-exported libdrpm.so drpm_strerror
  lib-exported libdrpm.so dump_hex
  lib-exported libdrpm.so expand_sequence
  lib-exported libdrpm.so fill_cpio_header
  lib-exported libdrpm.so fill_nodiff_deltarpm
  lib-exported libdrpm.so free_deltarpm
  lib-exported libdrpm.so get_open_file
  lib-exported libdrpm.so hash_create
  lib-exported libdrpm.so hash_free
  lib-exported libdrpm.so hash_search
  lib-exported libdrpm.so is_prelinked
  lib-exported libdrpm.so make_diff
  lib-exported libdrpm.so md5_update_be32
  lib-exported libdrpm.so open_new_file
  lib-exported libdrpm.so parse_be16
  lib-exported libdrpm.so parse_be32
  lib-exported libdrpm.so parse_be64
  lib-exported libdrpm.so parse_cpio_from_rpm_filedata
  lib-exported libdrpm.so parse_hex
  lib-exported libdrpm.so parse_hexnum
  lib-exported libdrpm.so parse_md5
  lib-exported libdrpm.so parse_sha256
  lib-exported libdrpm.so patches_check_nevr
  lib-exported libdrpm.so patches_destroy
  lib-exported libdrpm.so patches_read
  lib-exported libdrpm.so prelink_open
  lib-exported libdrpm.so read_be32
  lib-exported libdrpm.so read_be64
  lib-exported libdrpm.so read_deltarpm
  lib-exported libdrpm.so read_rpmlist
  lib-exported libdrpm.so resize16
  lib-exported libdrpm.so resize32
  lib-exported libdrpm.so rpm_archive_read_chunk
  lib-exported libdrpm.so rpm_archive_rewind
  lib-exported libdrpm.so rpm_destroy
  lib-exported libdrpm.so rpm_fetch_archive
  lib-exported libdrpm.so rpm_fetch_header
  lib-exported libdrpm.so rpm_fetch_lead_and_signature
  lib-exported libdrpm.so rpm_find_payload_format_offset
  lib-exported libdrpm.so rpm_get_comp
  lib-exported libdrpm.so rpm_get_comp_level
  lib-exported libdrpm.so rpm_get_digest_algo
  lib-exported libdrpm.so rpm_get_file_info
  lib-exported libdrpm.so rpm_get_nevr
  lib-exported libdrpm.so rpm_get_payload_format
  lib-exported libdrpm.so rpm_is_sourcerpm
  lib-exported libdrpm.so rpm_patch_payload_format
  lib-exported libdrpm.so rpm_read
  lib-exported libdrpm.so rpm_read_header
  lib-exported libdrpm.so rpm_replace_lead_and_signature
  lib-exported libdrpm.so rpm_signature_empty
  lib-exported libdrpm.so rpm_signature_get_md5
  lib-exported libdrpm.so rpm_signature_reload
  lib-exported libdrpm.so rpm_signature_set_md5
  lib-exported libdrpm.so rpm_signature_set_size
  lib-exported libdrpm.so rpm_size_full
  lib-exported libdrpm.so rpm_size_header
  lib-exported libdrpm.so rpm_write
  lib-exported libdrpm.so sfxsrt_create
  lib-exported libdrpm.so sfxsrt_free
  lib-exported libdrpm.so sfxsrt_search
  lib-exported libdrpm.so write_be32
  lib-exported libdrpm.so write_be64
  lib-exported libdrpm.so write_deltarpm
  lib-exported libdrpm.so write_seqfile

command "gcc -o test_bin {lib_linking_flags} test.c" "Compile binary"
  exit 0
  exist test_bin

+command "./test_bin" "Execute built binary"
  exit 0
