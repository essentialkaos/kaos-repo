# Bibop recipe for dataplaneapi
# See more: https://kaos.sh/bibop

pkg dataplaneapi

require-root yes
unsafe-actions yes

var service_name dataplaneapi
var sysconfig /etc/sysconfig/dataplaneapi
var logrotate_config /etc/logrotate.d/dataplaneapi
var delay 3

command "-" "Check environment"
  app dataplaneapi

  service-present {service_name}

  exist {sysconfig}
  mode {sysconfig} 644
  exist {logrotate_config}
  mode {logrotate_config} 644

command "systemctl start {service_name}" "Start dataplaneapi daemon"
  wait {delay}
  service-works {service_name}

command "systemctl status {service_name}" "Check status of dataplaneapi daemon"
  expect "active (running)"

command "systemctl stop {service_name}" "Stop dataplaneapi daemon"
  wait {delay}
  !service-works {service_name}
