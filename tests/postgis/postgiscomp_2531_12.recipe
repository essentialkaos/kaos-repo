# Bibop recipe for PostGIS 2.5 + PostGIS 3.0 for PostgreSQL 12
# See more: https://kaos.sh/bibop

pkg postgresql12-server postgis25_12 postgis25_12-client postgis31_12 postgis31_12-client

fast-finish yes

var postgres_version 12
var postgis_min_ver  2.5
var postgis_max_ver  3

var lib_dir /usr/pgsql-{postgres_version}/lib

command "-" "Check PostGIS 2.x"
  exist {lib_dir}/address_standardizer.so
  exist {lib_dir}/postgis-{postgis_min_ver}.so
  exist {lib_dir}/postgis_topology-{postgis_min_ver}.so
  exist {lib_dir}/rtpostgis-{postgis_min_ver}.so

  mode {lib_dir}/address_standardizer.so 755
  mode {lib_dir}/postgis-{postgis_min_ver}.so 755
  mode {lib_dir}/postgis_topology-{postgis_min_ver}.so 755
  mode {lib_dir}/rtpostgis-{postgis_min_ver}.so 755

command "-" "Check PostGIS 3.x"
  exist {lib_dir}/address_standardizer-{postgis_max_ver}.so
  exist {lib_dir}/postgis-{postgis_max_ver}.so
  exist {lib_dir}/postgis_raster-{postgis_max_ver}.so
  exist {lib_dir}/postgis_topology-{postgis_max_ver}.so

  mode {lib_dir}/address_standardizer-{postgis_max_ver}.so 755
  mode {lib_dir}/postgis-{postgis_max_ver}.so 755
  mode {lib_dir}/postgis_raster-{postgis_max_ver}.so 755
  mode {lib_dir}/postgis_topology-{postgis_max_ver}.so 755
