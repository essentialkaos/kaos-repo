# Bibop recipe for libbsd
# See more: https://kaos.sh/bibop

pkg libbsd libbsd-devel libbsd-ctor-static

fast-finish yes

var main_linking_flags "-lbsd"
var ctor_linking_flags "-lbsd-ctor -lbsd"
var overlay_linking_flags "-lbsd"

command "-" "Check shared libs"
  lib-loaded libbsd.so.*

command "-" "Check static libs"
  lib-exist libbsd-ctor.a

command "-" "Check headers"
  lib-header bsd

command "-" "Check pkg-config"
  lib-config libbsd
  lib-config libbsd-ctor
  lib-config libbsd-overlay

command "gcc -o test_main_bin {main_linking_flags} test_main.c" "Compile binary with libbsd"
  exit 0
  exist test_main_bin

+command "./test_main_bin" "Execute built binary"
  exit 0

command "gcc -o test_ctor_bin {ctor_linking_flags} test_ctor.c" "Compile binary with libbsd-ctor"
  exit 0
  exist test_ctor_bin

+command "./test_ctor_bin" "Execute built binary"
  exit 0

command "gcc -o test_overlay_bin {overlay_linking_flags} test_overlay.c" "Compile binary with libbsd-overlay"
  exit 0
  exist test_overlay_bin

+command "./test_overlay_bin" "Execute built binary"
  exit 0
