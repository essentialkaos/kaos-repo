# Bibop recipe for Libva
# See more: https://kaos.sh/bibop

pkg libva libva-devel

fast-finish yes

var lib_name libva
var lib_version 1

var main_linking_flags "-lva"
var drm_linking_flags "-lva-drm -lva"
var glx_linking_flags "-lva-glx -lva"
var x11_linking_flags "-lva-x11 -lva"
var tpi_linking_flags "-lva-tpi -lva"

command "-" "Check shared libs"
  lib-loaded {lib_name}.so.{lib_version}
  lib-loaded {lib_name}-drm.so.{lib_version}
  lib-loaded {lib_name}-glx.so.{lib_version}
  lib-loaded {lib_name}-tpi.so.{lib_version}
  lib-loaded {lib_name}-x11.so.{lib_version}

command "-" "Check headers"
  lib-header va

command "-" "Check pkg-config"
  lib-config {lib_name}
  lib-config {lib_name}-drm
  lib-config {lib_name}-glx
  lib-config {lib_name}-tpi
  lib-config {lib_name}-x11

command "gcc -o test_main_bin {main_linking_flags} test_main.c" "Compile binary with libva"
  exit 0
  exist test_main_bin

+command "./test_main_bin" "Execute built binary"
  exit 0

command "gcc -o test_drm_bin {drm_linking_flags} test_drm.c" "Compile binary with libva-drm"
  exit 0
  exist test_drm_bin

+command "./test_drm_bin" "Execute built binary"
  exit 0

command "gcc -o test_glx_bin {glx_linking_flags} test_glx.c" "Compile binary with libva-glx"
  exit 0
  exist test_glx_bin

+command "./test_glx_bin" "Execute built binary"
  exit 0

command "gcc -o test_x11_bin {x11_linking_flags} test_x11.c" "Compile binary with libva-x11"
  exit 0
  exist test_x11_bin

+command "./test_x11_bin" "Execute built binary"
  exit 0

command "gcc -o test_tpi_bin {tpi_linking_flags} test_tpi.c" "Compile binary with libva-tpi"
  exit 0
  exist test_tpi_bin

+command "./test_tpi_bin" "Execute built binary"
  exit 0
