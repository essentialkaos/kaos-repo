# Bibop recipe for Kafka Exporter on CentOS 6
# See more: https://github.com/essentialkaos/bibop

pkg kafka-exporter

require-root yes

var log_dir          /var/log/kafka-exporter
var sysconfig        /etc/sysconfig/kafka-exporter
var logrotate_config /etc/logrotate.d/kafka-exporter

var service_user  kafka-exporter
var service_group kafka-exporter
var service_name  kafka-exporter

var delay 3

command "-" "Check binaries and service"
  app kafka-exporter

  service-present {service_name}

command "-" "Check configuration files"
  exist {sysconfig}
  perms {sysconfig} 644
  owner {sysconfig} root:root

  exist {logrotate_config}
  owner {logrotate_config} root:root

command "-" "Check logs directory"
  exist {log_dir}
  dir {log_dir}
  perms {log_dir} 755
  owner {log_dir} {service_user}:{service_group}

command "service {service_name} start" "Start Kafka Exporter daemon"
  exit 0
  service-works {service_name}

command "-" "Check logs"
  exist {log_dir}/{service_name}.log
  perms {log_dir}/{service_name}.log 644
  owner {log_dir}/{service_name}.log {service_user}:{service_group}

command "service {service_name} status" "Check status of Kafka Exporter daemon"
  exit 0

command "service {service_name} stop" "Stop Kafka Exporter daemon"
  exit 0
  !service-works {service_name}
